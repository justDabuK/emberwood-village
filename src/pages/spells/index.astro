---
import BaseLayout from "../../layouts/BaseLayout.astro";
import MarkdownLink from "../../components/MarkdownLink.astro";
import {MarkdownInstance} from "astro";

enum possiblePrerequisites {
    LEVEL_8 = 'can cast 8th level spells',
    KNOWS_CONTAMINATED_SPELLS = 'know every other contaminated spell',
    CAST_ALL_CONTAMINATED_SPELLS = 'cast each other contaminated spell at least once',
    MONSTROUS_TRANFORMATION = 'witnessed monstrous transformation',
    LEVEL_7 = 'can cast 7th level spells',
    NEUTRALIZING_FIELD = 'knows the Neutralizing Field spell',
    DELIRIUM_HEART = 'visited the *Delirium Heart*',
    LEVEL_5 = 'can cast 5th level spells',
    PURGE_CONTAMINATION = 'knows the purge contamination spell',
    AQUA_EXPURGO = 'created at least 1 dose of aqua expurgo',
    LEVEL_6 = 'can cast 6th level spells',
    FORCED_EVOLUTION = 'knows the forced evolution spell',
    SUMMON_DELERIUM_ELEMENTAL = 'knows the summon delerium elemental spell',
    SLAYED_DELERIUM_DRAGON = 'slayed a delerium dragon and examined it',
}

const achievedPrerequisites = [
    possiblePrerequisites.MONSTROUS_TRANFORMATION,
]

const byTitle = (a: MarkdownInstance<Record<string, any>>, b: MarkdownInstance<Record<string, any>>): number => {
    if(a.frontmatter.title < b.frontmatter.title) {
        return -1;
    } else if(a.frontmatter.title > b.frontmatter.title) {
        return 1;
    } else {
        return 0;
    }
}

const allSpells = (await Astro.glob("/src/pages/spells/*.md")).sort(byTitle);
---
<BaseLayout title="Spells">
    <a href="/spells/levels">
        <div>
            Sort by Level
        </div>
    </a>
    <ul>
        {
            allSpells.map((spell) =>
                    <MarkdownLink url={spell.url} title={spell.frontmatter.title} disabled={spell.frontmatter.disabled} >
                        {
                            spell.frontmatter.prerequisites && spell.frontmatter.prerequisites.length > 0
                                ? <ul>
                                    {spell.frontmatter.prerequisites.map((prerequisite) => <li>{achievedPrerequisites.includes(prerequisite) ? prerequisite : "???"}</li>)}

                                    </ul>
                                : null
                        }
                    </MarkdownLink>
            )
        }
    </ul>
    <!-- TODO: add the normal spells from sebastion crowe's guide to Drakkenheim as well-->
</BaseLayout>